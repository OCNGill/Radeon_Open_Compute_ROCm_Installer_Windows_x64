<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Fragment>
    <ComponentGroup Id="LMStudioComponents">
      <ComponentRef Id="LMStudioShortcuts" />
      <ComponentRef Id="LMStudioConfig" />
      <ComponentRef Id="StreamlitGUI" />
      <ComponentRef Id="DesktopShortcuts" />
    </ComponentGroup>

    <DirectoryRef Id="INSTALLFOLDER">
 <Directory Id="GUIFolder" Name="gui">
        <Component Id="StreamlitGUI" Guid="{e1a54d97-4b41-4a4c-94f3-1f58cba516b2}">
   <!-- Streamlit GUI files -->
     <File Id="streamlit_app.py" Source="..\src\gui\streamlit_app.py" KeyPath="yes" />
    <File Id="streamlit_app_simple.py" Source="..\src\gui\streamlit_app_simple.py" />

   <!-- Logging utilities -->
     <File Id="logging_utils.py" Source="..\src\utils\logging_utils.py" />
        </Component>
    </Directory>

      <Directory Id="LMStudioFolder" Name="lm_studio">
  <Component Id="LMStudioConfig" Guid="{f2b65ea8-5c52-4b5d-a5e4-2e69dcb627c3}">
    <!-- LM Studio configuration and links -->
          <IniFile Id="LMStudioDownload"
     Action="createLine"
     Directory="LMStudioFolder"
  Name="download.ini"
                   Section="LMStudio"
Key="URL"
    Value="https://lmstudio.ai/download" />
        
   <IniFile Id="LMStudioDocs"
    Action="createLine"
         Directory="LMStudioFolder"
          Name="download.ini"
Section="LMStudio"
       Key="Docs"
     Value="https://lmstudio.ai/docs" />
        
   <RegistryKey Root="HKLM" Key="Software\ROCm\LLMGUI">
       <RegistryValue Type="string" Name="Type" Value="LMStudio" KeyPath="yes" />
        <RegistryValue Type="string" Name="DownloadURL" Value="https://lmstudio.ai/download" />
 </RegistryKey>
</Component>
      </Directory>
  </DirectoryRef>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="LMStudioShortcuts" Guid="{a3c76fb9-6d63-4c6e-b6f5-3f7aedc738d4}">
      <Shortcut Id="StreamlitGUIShortcut"
       Name="ROCm Streamlit Dashboard"
        Description="Launch ROCm monitoring and testing dashboard"
        Target="[WindowsFolder]System32\wsl.exe"
     Arguments="-d Ubuntu-22.04 bash -c 'cd [GUIFolder] &amp;&amp; streamlit run streamlit_app.py'"
    WorkingDirectory="GUIFolder" />
        
   <Shortcut Id="LMStudioDownloadShortcut"
            Name="Download LM Studio"
    Description="Open LM Studio download page"
    Target="https://lmstudio.ai/download" />

   <RemoveFolder Id="RemoveLMStudioShortcuts" On="uninstall" />
  <RegistryValue Root="HKCU" 
    Key="Software\ROCm\LLMGUI" 
      Name="installed" 
       Type="integer" 
   Value="1" 
       KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="DesktopFolder">
      <Component Id="DesktopShortcuts" Guid="{b4d87fca-7e74-4d7f-a7b6-4a8bfed849e5}">
        <Shortcut Id="DesktopStreamlitShortcut"
  Name="ROCm Dashboard"
          Description="ROCm monitoring and testing dashboard"
  Target="[WindowsFolder]System32\wsl.exe"
  Arguments="-d Ubuntu-22.04 bash -c 'cd [GUIFolder] &amp;&amp; streamlit run streamlit_app.py'"
    WorkingDirectory="GUIFolder" />
        
        <RegistryValue Root="HKCU" 
    Key="Software\ROCm\Desktop" 
            Name="shortcuts" 
        Type="integer" 
  Value="1" 
       KeyPath="yes" />
</Component>
</DirectoryRef>
  </Fragment>
</Wix>
